<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.tbs.mapper.OrderMapper">
    <!--查询所有用户信息-->
    <update id="updateById">
        update orders
        set productid = null
        where productid = #{id}
    </update>


    <resultMap id="orderMap" type="cn.tbs.pojo.Orders" autoMapping="true">
        <id property="id" column="id"/>
        <association property="product" javaType="Product" autoMapping="true">
            <id property="id" column="id"/>
        </association>
    </resultMap>

    <select id="findAll" resultMap="orderMap">
        select *
        from orders o,
             product p
        where o.productId = p.id
    </select>

    <resultMap id="findByIdResultMap" type="Orders" autoMapping="true">
        <!--映射order-->
        <id property="id" column="oid"/>

        <!--映射product-->
        <association property="product" javaType="Product" autoMapping="true">
            <id property="id" column="pid"/>
        </association>

        <!--映射member-->
        <association property="member" javaType="Member" autoMapping="true">
            <id property="id" column="mid"/>
        </association>

        <!--映射traveller-->
        <collection property="travellers" javaType="List" ofType="Traveller" autoMapping="true">
            <id property="id" column="tid"/>
        </collection>
    </resultMap>
    <select id="findById" resultMap="findByIdResultMap">
        SELECT
            *,
            o.id as oid,
            p.id as pid,
            m.id as mid,
            t.id as tid
        FROM
            orders o
                LEFT JOIN product p ON o.productId = p.id
                left join order_traveller ot on ot.orderId = o.id
                left join traveller t on ot.travellerId = t.id
                left join member m on o.memberId = m.id
        where o.id = #{id}
    </select>


    <insert id="save">
        insert into orders(
            orderNum,
            orderTime,
            peopleCount,
            orderDesc,
            payType,
            orderStatus,
            productId,
            memberId)
        values(#{orderNum},
               #{orderTime},
               #{peopleCount},
               #{orderDesc},
               #{payType},
               #{orderStatus},
               #{productId},
               #{memberId})
    </insert>


    <select id="findByOrderNum" resultType="integer">
        select id from orders where orderNum = #{orderNum}
    </select>
</mapper>